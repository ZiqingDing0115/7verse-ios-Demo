# åç«¯æ¶æ„è®¾è®¡æ–¹æ¡ˆ

## ğŸ—ï¸ æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  React å‰ç«¯  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ HTTPS/REST
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       API Gateway (Node.js)          â”‚
â”‚  â”œâ”€ èº«ä»½è®¤è¯/é‰´æƒ                     â”‚
â”‚  â”œâ”€ è¯·æ±‚è·¯ç”±                         â”‚
â”‚  â”œâ”€ é™æµ/é˜²æŠ¤                        â”‚
â”‚  â””â”€ æ—¥å¿—ç›‘æ§                         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚      â”‚  AI æœåŠ¡å±‚        â”‚
       â”‚      â”‚  (GPT-4 / Claude) â”‚
       â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚      â”‚  å›¾ç”Ÿå›¾æœåŠ¡å±‚     â”‚
       â”‚      â”‚  (SD / Midjourney)â”‚
       â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚      â”‚  éŸ³è‰²æœåŠ¡å±‚       â”‚
       â”‚      â”‚  (TTS API)        â”‚
       â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â””â”€â”€â”€â”€â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  è§†é¢‘ç”ŸæˆæœåŠ¡å±‚   â”‚
              â”‚  (D-ID / HeyGen)  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¡ API æ¥å£è®¾è®¡

### 1. æ ‡ç­¾æ¨è API

**Endpoint:** `POST /api/recommend-tags`

**Request:**
```json
{
  "image": "data:image/jpeg;base64,/9j/4AAQSkZJRg...",
  "user_id": "optional_user_id"
}
```

**Response:**
```json
{
  "success": true,
  "tags": ["Adventurous", "Social butterfly", "Cinematic", ...],
  "duration": "2.3s",
  "ai_model": "gpt-4-vision-preview"
}
```

---

### 2. å›¾ç”Ÿå›¾ API

**Endpoint:** `POST /api/generate-images`

**Request:**
```json
{
  "source_image": "data:image/jpeg;base64,...",
  "selected_tags": ["Cyberpunk", "Neon", "Futuristic"],
  "user_id": "optional_user_id"
}
```

**Response:**
```json
{
  "success": true,
  "prompts": [
    "A photorealistic cyberpunk portrait...",
    "A stylized comic book panel...",
    "A cinematic film still...",
    "A futuristic glitch art..."
  ],
  "generated_images": [
    {
      "url": "https://cdn.example.com/img1.jpg",
      "prompt": "...",
      "style_index": 0
    },
    ...
  ],
  "duration": "8.5s",
  "model": "stable-diffusion-xl"
}
```

---

### 3. éŸ³è‰²æ¨è API

**Endpoint:** `POST /api/recommend-voice`

**Request:**
```json
{
  "image": "data:image/jpeg;base64,...",
  "selected_tags": ["Adventurous", "Social butterfly"],
  "user_id": "optional_user_id"
}
```

**Response:**
```json
{
  "success": true,
  "recommended_voice": {
    "id": "lively-woman",
    "name": "Lively woman",
    "reasoning": "The energetic vibe matches..."
  },
  "voice_library": [...],
  "duration": "1.2s"
}
```

---

### 4. è§†é¢‘ç”Ÿæˆ API

**Endpoint:** `POST /api/generate-video`

**Request:**
```json
{
  "image_url": "https://cdn.example.com/final.jpg",
  "voice_id": "lively-woman",
  "script_text": "Hey there! Welcome to my world.",
  "selected_tags": [...],
  "user_id": "optional_user_id"
}
```

**Response:**
```json
{
  "success": true,
  "video_url": "https://cdn.example.com/preview.mp4",
  "script": {...},
  "video_prompt": "A close-up shot, the character smiles warmly...",
  "duration": "15.3s",
  "model": "d-id"
}
```

---

## ğŸ”§ æŠ€æœ¯æ ˆæ¨è

### æ–¹æ¡ˆ Aï¼šNode.js + Expressï¼ˆæ¨èå¿«é€Ÿå¼€å‘ï¼‰

```javascript
// server.js
const express = require('express');
const multer = require('multer');
const app = express();

app.post('/api/recommend-tags', async (req, res) => {
  const { image } = req.body;
  
  // 1. è°ƒç”¨ OpenAI Vision API
  const tags = await callGPT4Vision(image);
  
  res.json({ success: true, tags });
});

app.post('/api/generate-images', async (req, res) => {
  const { source_image, selected_tags } = req.body;
  
  // 1. è°ƒç”¨ GPT-4 ç”Ÿæˆ 4 ä¸ª prompt
  const prompts = await generatePrompts(source_image, selected_tags);
  
  // 2. å¹¶è¡Œè°ƒç”¨ Stable Diffusion ç”Ÿæˆ 4 å¼ å›¾
  const images = await Promise.all(
    prompts.map(prompt => generateImage(source_image, prompt))
  );
  
  res.json({ success: true, prompts, images });
});

app.listen(3000);
```

**ä¼˜ç‚¹ï¼š**
- å¿«é€Ÿå¼€å‘ï¼Œç”Ÿæ€ä¸°å¯Œ
- å¼‚æ­¥å¤„ç†å¤©ç„¶æ”¯æŒ
- éƒ¨ç½²ç®€å•

---

### æ–¹æ¡ˆ Bï¼šPython + FastAPIï¼ˆæ¨è AI é›†æˆï¼‰

```python
# main.py
from fastapi import FastAPI, File, UploadFile
from services.ai_service import recommend_tags, generate_images

app = FastAPI()

@app.post("/api/recommend-tags")
async def api_recommend_tags(image: str):
    tags = await recommend_tags(image)
    return {"success": True, "tags": tags}

@app.post("/api/generate-images")
async def api_generate_images(image: str, tags: list):
    prompts = await generate_prompts(image, tags)
    images = await asyncio.gather(*[
        generate_image(image, prompt) for prompt in prompts
    ])
    return {"success": True, "prompts": prompts, "images": images}
```

**ä¼˜ç‚¹ï¼š**
- AI/ML ç”Ÿæ€æœ€å¼ºï¼ˆPyTorch, Hugging Faceï¼‰
- å¯ä»¥æœ¬åœ°éƒ¨ç½² Stable Diffusion
- æ€§èƒ½ä¼˜ç§€

---

## ğŸ–¼ï¸ å›¾ç”Ÿå›¾æ¨¡å‹é€‰æ‹©

### æ¨èæ–¹æ¡ˆï¼šStable Diffusion XL + Replicate

**ä¸ºä»€ä¹ˆé€‰æ‹©è¿™ä¸ªæ–¹æ¡ˆï¼Ÿ**
1. **é€Ÿåº¦å¿«**ï¼šReplicate æ‰˜ç®¡çš„ SDXL-Turbo çº¦ 5-8 ç§’
2. **è´¨é‡é«˜**ï¼šSDXL æ˜¯ç›®å‰å¼€æºæœ€å¼ºçš„å›¾ç”Ÿå›¾æ¨¡å‹
3. **æˆæœ¬ä½**ï¼šæŒ‰æ¬¡ä»˜è´¹ï¼Œçº¦ $0.01-0.03 / å¼ 
4. **æ˜“é›†æˆ**ï¼šREST APIï¼Œæ— éœ€è‡ªå»º GPU

**ä»£ç ç¤ºä¾‹ï¼ˆNode.jsï¼‰ï¼š**

```javascript
const Replicate = require('replicate');

const replicate = new Replicate({
  auth: process.env.REPLICATE_API_TOKEN,
});

async function generateImage(sourceImage, prompt) {
  const output = await replicate.run(
    "stability-ai/sdxl:39ed52f2a78e934b3ba6e2a89f5b1c712de7dfea535525255b1aa35c5565e08b",
    {
      input: {
        image: sourceImage,
        prompt: prompt,
        negative_prompt: "low quality, blurry, ugly, distorted",
        num_inference_steps: 30,
        guidance_scale: 7.5,
        strength: 0.75, // å›¾ç”Ÿå›¾å¼ºåº¦
      }
    }
  );
  
  return output[0]; // è¿”å›å›¾ç‰‡ URL
}
```

**å…¶ä»–é€‰æ‹©ï¼š**
- **æœ¬åœ°éƒ¨ç½² ComfyUI**ï¼šæœ€çµæ´»ï¼Œä½†éœ€è¦ GPU æœåŠ¡å™¨ï¼ˆçº¦ $0.5/å°æ—¶ï¼‰
- **é€šä¹‰ä¸‡ç›¸**ï¼šå›½å†…è®¿é—®å¿«ï¼Œé˜¿é‡Œäº‘ API
- **Midjourney**ï¼šè´¨é‡æœ€é«˜ï¼Œä½†æ…¢ä¸”è´µï¼ˆçº¦ 30-60 ç§’/å¼ ï¼‰

---

## ğŸ™ï¸ TTSï¼ˆè¯­éŸ³åˆæˆï¼‰æœåŠ¡

### æ¨èï¼šElevenLabs API

**ç‰¹ç‚¹ï¼š**
- éŸ³è‰²è‡ªç„¶åº¦æœ€é«˜
- æ”¯æŒè‡ªå®šä¹‰éŸ³è‰²å…‹éš†
- æŒ‰å­—ç¬¦ä»˜è´¹

**ä»£ç ç¤ºä¾‹ï¼š**

```javascript
const axios = require('axios');

async function generateVoice(text, voiceId) {
  const response = await axios.post(
    `https://api.elevenlabs.io/v1/text-to-speech/${voiceId}`,
    {
      text: text,
      model_id: "eleven_multilingual_v2",
      voice_settings: {
        stability: 0.5,
        similarity_boost: 0.8
      }
    },
    {
      headers: {
        'xi-api-key': process.env.ELEVENLABS_API_KEY,
        'Content-Type': 'application/json'
      },
      responseType: 'arraybuffer'
    }
  );
  
  return response.data; // è¿”å›éŸ³é¢‘æ–‡ä»¶
}
```

---

## ğŸ¬ è§†é¢‘ç”ŸæˆæœåŠ¡

### æ¨èï¼šD-ID API

**ç‰¹ç‚¹ï¼š**
- æ•°å­—äººå£å‹åŒæ­¥
- æ”¯æŒè‡ªå®šä¹‰å¤´åƒ
- ç”Ÿæˆé€Ÿåº¦å¿«ï¼ˆçº¦ 10-20 ç§’ï¼‰

**ä»£ç ç¤ºä¾‹ï¼š**

```javascript
const axios = require('axios');

async function generateVideo(imageUrl, audioUrl) {
  // 1. åˆ›å»ºè§†é¢‘ä»»åŠ¡
  const createResponse = await axios.post(
    'https://api.d-id.com/talks',
    {
      source_url: imageUrl,
      script: {
        type: 'audio',
        audio_url: audioUrl
      },
      config: {
        result_format: 'mp4'
      }
    },
    {
      headers: {
        'Authorization': `Basic ${process.env.DID_API_KEY}`,
        'Content-Type': 'application/json'
      }
    }
  );
  
  const talkId = createResponse.data.id;
  
  // 2. è½®è¯¢è§†é¢‘ç”ŸæˆçŠ¶æ€
  let videoUrl = null;
  while (!videoUrl) {
    await new Promise(resolve => setTimeout(resolve, 3000));
    
    const statusResponse = await axios.get(
      `https://api.d-id.com/talks/${talkId}`,
      {
        headers: {
          'Authorization': `Basic ${process.env.DID_API_KEY}`
        }
      }
    );
    
    if (statusResponse.data.status === 'done') {
      videoUrl = statusResponse.data.result_url;
    }
  }
  
  return videoUrl;
}
```

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. å¹¶è¡Œå¤„ç†
```javascript
// âŒ ä¸²è¡Œï¼ˆæ…¢ï¼‰
const tags = await recommendTags(image);
const voice = await recommendVoice(image, tags);

// âœ… å¹¶è¡Œï¼ˆå¿«ï¼‰
const [tags, voice] = await Promise.all([
  recommendTags(image),
  recommendVoice(image, [])
]);
```

### 2. ç¼“å­˜ç­–ç•¥
```javascript
// ä½¿ç”¨ Redis ç¼“å­˜å›¾ç”Ÿå›¾ç»“æœ
const cacheKey = `img2img:${imageHash}:${tagsHash}`;
const cached = await redis.get(cacheKey);
if (cached) return cached;

const result = await generateImages(...);
await redis.setex(cacheKey, 3600, JSON.stringify(result));
```

### 3. CDN åŠ é€Ÿ
- å›¾ç‰‡/è§†é¢‘ä¸Šä¼ åˆ° CDNï¼ˆé˜¿é‡Œäº‘ OSS / AWS S3ï¼‰
- å‡å°‘ä¼ è¾“æ—¶é—´

---

## ğŸ’° æˆæœ¬ä¼°ç®—ï¼ˆæ¯æ¬¡å®Œæ•´æµç¨‹ï¼‰

| æœåŠ¡ | æä¾›å•† | æˆæœ¬ |
|------|--------|------|
| æ ‡ç­¾æ¨èï¼ˆGPT-4 Visionï¼‰ | OpenAI | ~$0.02 |
| å›¾ç”Ÿå›¾ Promptsï¼ˆGPT-4ï¼‰ | OpenAI | ~$0.01 |
| å›¾ç”Ÿå›¾ç”Ÿæˆï¼ˆ4å¼ ï¼‰| Replicate (SDXL) | ~$0.08 |
| éŸ³è‰²æ¨èï¼ˆGPT-4 Visionï¼‰ | OpenAI | ~$0.02 |
| TTS è¯­éŸ³åˆæˆ | ElevenLabs | ~$0.05 |
| è§†é¢‘ç”Ÿæˆ | D-ID | ~$0.30 |
| **æ€»è®¡** | | **~$0.48/æ¬¡** |

---

## ğŸš€ éƒ¨ç½²å»ºè®®

### å¼€å‘é˜¶æ®µ
- å‰ç«¯ï¼šVite Dev Server (æœ¬åœ°)
- åç«¯ï¼šNode.js / Python æœ¬åœ°è¿è¡Œ
- ä½¿ç”¨å„æœåŠ¡å•†çš„ APIï¼ˆæ— éœ€è‡ªå»ºï¼‰

### ç”Ÿäº§é˜¶æ®µ
- å‰ç«¯ï¼šVercel / Netlifyï¼ˆå…è´¹ï¼‰
- åç«¯ï¼šAWS Lambda / é˜¿é‡Œäº‘å‡½æ•°è®¡ç®—ï¼ˆæŒ‰é‡ä»˜è´¹ï¼‰
- CDNï¼šCloudflareï¼ˆå…è´¹ï¼‰
- æ•°æ®åº“ï¼šMongoDB Atlasï¼ˆå…è´¹é¢åº¦ï¼‰

---

